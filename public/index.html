<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>My Game Library</title>
    <!--
        Main SPA shell for the Video Game Database app.
        This file contains the static structure: header, tabs, controls, display grid,
        and modal dialogs. JavaScript in `/js/app.js` will wire up behavior.
        The UI uses a dark theme provided by `/css/style.css`.
    -->
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <!-- App container -->
    <div id="app" class="app-root">
        <!-- Header with title, search and action buttons -->
        <header class="app-header">
            <div class="title-area">
                <h1 id="app-title">My Game Library</h1>
                <p class="subtitle">A personal catalog for the games you love</p>
            </div>

            <div class="header-controls">
                <!-- Search bar: JS will wire this to filter results -->
                <div style="display:flex;align-items:center;gap:8px">
                    <input id="search-input" class="search-input" type="search" placeholder="Search for games, tags, descriptions..." aria-label="Search" />
                    <div class="help-icon" tabindex="0" aria-label="Search help">?
                        <div class="help-tooltip">Type "exact phrase" for exact match; otherwise multiple words are treated as AND.</div>
                    </div>
                </div>

                <!-- Primary action buttons -->
                <div class="button-group">
                    <button id="btn-add-game" class="btn btn-primary">Add Game</button>
                    <button id="btn-add-platform" class="btn">Add Platform</button>
                    <button id="btn-import-csv" class="btn">Import from CSV</button>
                </div>
            </div>
        </header>

        <!-- Main area containing tabs, controls and display grid -->
        <main class="main-area">
            <!-- Tabs -->
            <nav class="tabs" role="tablist">
                <button class="tab active" data-tab="games" role="tab" aria-selected="true">Games <span class="tab-count"></span></button>
                <button class="tab" data-tab="platforms" role="tab" aria-selected="false">Platforms <span class="tab-count"></span></button>
            </nav>

            <!-- Controls bar: sorting + filtering -->
            <section class="controls-bar">
                <div class="left-controls">
                    <label for="sort-select">Sort by:</label>
                    <select id="sort-select">
                        <option value="name_asc">Name (A-Z)</option>
                        <option value="name_desc">Name (Z-A)</option>
                        <option value="year_desc">Release Year (Newest)</option>
                        <option value="year_asc">Release Year (Oldest)</option>
                    </select>
                </div>

                <div class="right-controls" id="games-controls">
                    <button id="btn-filter" class="btn btn-sm">üîç Filter</button>
                    <button id="btn-display" class="btn btn-sm">üñº Display</button>
                    <span id="active-filters" class="active-filters"></span>
                </div>
            </section>

            <!-- Display grid: cards will be rendered here via JS -->
            <section id="display-grid" class="display-grid" aria-live="polite">
                <!-- Cards will be dynamically rendered by JavaScript -->
            </section>
        </main>
    </div>

    <!-- Modals (hidden by default) -->
    <!-- Add / Edit Game Modal -->
    <div id="modal-game" class="modal" aria-hidden="true">
        <div class="modal-content">
            <header class="modal-header">
                <h2 id="modal-game-title">Add / Edit Game</h2>
                <button class="modal-close" data-close>&times;</button>
            </header>
            <form id="form-game" class="modal-form" data-id-holder>
                <label>Game Title<input type="text" name="name" required></label>
                <label>Description<textarea name="description"></textarea></label>
                <label>Cover Image URL<input type="url" name="cover_image_url"></label>
                <label>Trailer URL<input type="url" name="trailer_url"></label>
                <label>Tags (comma-separated)<input type="text" name="tags" placeholder="e.g., action, RPG, indie"></label>

                <div class="inline-radios">
                    <span>Type:</span>
                    <label><input type="radio" name="game_type" value="original" checked> Original</label>
                    <label><input type="radio" name="game_type" value="remake"> Remake</label>
                    <label><input type="radio" name="game_type" value="remaster"> Remaster</label>
                </div>
                <div id="link-game-section" style="display:none;">
                    <label>Link to Original Game
                        <input type="text" name="related_game_id" placeholder="Enter game ID or name">
                    </label>
                    <button type="button" id="btn-link-game" class="btn btn-sm">Find & Link</button>
                </div>
                <div id="game-platforms-section">
                    <label class="label-with-button"><span>Associated Platforms (immediately saved)</span><button type="button" id="btn-associate-platform" class="btn btn-sm">Associate with Platform</button></label>
                    <ul id="game-platforms-list" class="item-list pills">
                        <!-- JS will populate this list -->
                    </ul>
                </div>
                <div class="modal-actions">
                    <div class="button-group">
                        <button type="submit" class="btn btn-primary">Save</button>
                        <button type="button" class="btn" data-close>Cancel</button>
                    </div>
                    <div class="button-group">
                        <button type="button" class="btn btn-clone">Clone</button>
                        <button type="button" class="btn btn-delete">Delete</button>
                    </div>
                </div>
            </form>
        </div>

    </div>

    <!-- Add Game to Platform Modal -->
    <div id="modal-add-to-platform" class="modal" aria-hidden="true">
        <div class="modal-content">
            <header class="modal-header">
                <h2>Add Game to Platform</h2>
                <button class="modal-close" data-close>&times;</button>
            </header>
            <form id="form-add-to-platform" class="modal-form">
                <div>
                    <div class="label-with-button" style="margin-bottom: 8px;">
                        <label>Platform:</label>
                        <div class="sort-controls">
                            <span>Sort by:</span>
                            <select id="platform-sort-select">
                                <option value="name_asc">Name (A-Z)</option>
                                <option value="name_desc">Name (Z-A)</option>
                                <option value="count_desc">Games (Most)</option>
                                <option value="count_asc">Games (Fewest)</option>
                            </select>
                        </div>
                    </div>
                    <div id="platform-radio-group" class="pill-group">
                        <!-- JS will populate platform radio options -->
                    </div>
                </div>
                <div id="format-section">
                    <label>Format:</label>
                    <div id="format-checkbox-group" class="pill-group">
                        <!-- JS will populate format checkboxes based on platform support -->
                    </div>
                </div>
                <div>
                    <label>Acquired:</label>
                    <div id="acquisition-method-group" class="pill-group"></div>
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn btn-primary">Add</button>
                    <button type="button" class="btn" data-close>Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add / Edit Platform Modal -->
    <div id="modal-platform" class="modal" aria-hidden="true">
        <div class="modal-content">
            <header class="modal-header">
                <h2 id="modal-platform-title">Add / Edit Platform</h2>
                <button class="modal-close" data-close>&times;</button>
            </header>
            <form id="form-platform" class="modal-form" data-id-holder>
                <label>Platform Name<input type="text" name="name" required></label>
                <div class="inline-checkboxes">
                    <span>Supported Formats:</span>
                    <label><input type="checkbox" name="supports_digital" checked> Digital</label>
                    <label><input type="checkbox" name="supports_physical"> Physical</label>
                </div>
                <label>Description<textarea name="description"></textarea></label>
                <label>Icon URL<input type="url" name="icon_url"></label>
                <label>Image URL<input type="url" name="image_url"></label>
                <label>Year Acquired<input type="number" name="year_acquired" min="1980" max="2100"></label>
                <div class="modal-actions">
                    <button type="submit" class="btn btn-primary">Save</button>
                    <button type="button" class="btn" data-close>Cancel</button>
                    <button type="button" class="btn btn-clone" style="margin-left: auto;">Clone</button>
                    <button type="button" class="btn btn-delete">Delete</button>
                </div>
            </form>
        </div>
    </div>

    <!-- CSV Import Modal -->
    <div id="modal-import" class="modal" aria-hidden="true">
        <div class="modal-content" style="max-width:90vw;width:90vw;">
            <header class="modal-header">
                <h2>Import from CSV</h2>
                <button class="modal-close" data-close>&times;</button>
            </header>
            <div class="modal-body" style="display:flex;flex-direction:column;gap:12px;max-height:85vh;overflow-y:auto;">
                <div>
                    <input id="csv-file-input" type="file" accept="text/csv" />
                    <p class="muted">Upload a CSV file or paste CSV text. You will be able to map columns before importing.</p>
                </div>
                <textarea id="csv-textarea" rows="6" placeholder="Paste CSV here or choose a file" style="width:100%;box-sizing:border-box;"></textarea>
                <div>
                    <h4>Column Mapping</h4>
                    <div id="csv-mapping" class="csv-mapping" style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;">
                        <!-- Mapping UI will be injected here: header -> db field select -->
                    </div>
                </div>
                <div>
                    <h4>Preview</h4>
                    <div id="csv-preview-table" style="max-height:200px;overflow:auto;border:1px solid var(--muted);padding:6px;background:var(--panel-bg);"></div>
                </div>
                <div style="display:flex;gap:8px;align-items:center;">
                    <label style="white-space:nowrap">On duplicate:</label>
                    <select id="import-duplicate-policy">
                        <option value="create_new">Create new</option>
                        <option value="skip">Skip</option>
                        <option value="merge">Merge</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button id="btn-run-import" class="btn btn-primary">Run Import</button>
                    <button class="btn" data-close>Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Filter Modal -->
    <div id="modal-filter" class="modal" aria-hidden="true">
        <div class="modal-content">
            <header class="modal-header">
                <h2>Filter Games</h2>
                <button class="modal-close" data-close>&times;</button>
            </header>
            <form id="form-filter" class="modal-form">
                <div style="display:flex;align-items:center;gap:8px">
                    <div style="flex:1">
                        <label>Search by Name, Tag or Keyword</label>
                        <input type="text" id="filter-keyword" placeholder="e.g., Zelda, action, RPG...">
                    </div>
                    <div class="help-icon" tabindex="0" aria-label="Search help">?
                        <div class="help-tooltip">Type "exact phrase" for exact match; otherwise multiple words are treated as AND.</div>
                    </div>
                </div>

                <div>
                    <div class="label-with-button" style="margin-bottom: 8px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <label>Filter by Platform</label>
                            <div class="pill-group" style="padding-top: 0;">
                                <input type="radio" name="platform_mode" value="or" id="platform_mode_or">
                                <label for="platform_mode_or">Any (OR)</label>
                                <input type="radio" name="platform_mode" value="and" id="platform_mode_and">
                                <label for="platform_mode_and">All (AND)</label>
                            </div>
                        </div>
                        <div class="sort-controls">
                            <span>Sort by:</span>
                            <select id="filter-platform-sort-select">
                                <option value="name_asc">Name (A-Z)</option>
                                <option value="name_desc">Name (Z-A)</option>
                                <option value="count_desc">Games (Most)</option>
                                <option value="count_asc">Games (Fewest)</option>
                            </select>
                        </div>
                    </div>
                    <div id="filter-platforms" class="pill-group scrollable-pill-group">
                        <!-- JS will populate platform checkboxes -->
                    </div>
                </div>

                <div>
                    <div class="label-with-button" style="margin-bottom: 8px;">
                        <label>Filter by Tags</label>
                        <div class="sort-controls">
                            <span>Sort by:</span>
                            <select id="filter-tag-sort-select">
                                <option value="name_asc">Name (A-Z)</option>
                                <option value="name_desc">Name (Z-A)</option>
                                <option value="count_desc">Usage (Most)</option>
                                <option value="count_asc">Usage (Fewest)</option>
                            </select>
                        </div>
                    </div>
                    <div id="filter-tags" class="pill-group scrollable-pill-group">
                        <!-- JS will populate tag checkboxes -->
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="submit" class="btn btn-primary">Apply Filters</button>
                    <button type="button" id="btn-clear-filters" class="btn">Clear All</button>
                    <button type="button" class="btn" data-close>Close</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Display Modal -->
    <div id="modal-display" class="modal" aria-hidden="true">
        <div class="modal-content">
            <header class="modal-header">
                <h2>Display Options</h2>
                <button class="modal-close" data-close>&times;</button>
            </header>
            <form id="form-display" class="modal-form">
                <div class="inline-checkboxes">
                    <label><input type="checkbox" name="show_cover" checked> Cover Art</label>
                    <label><input type="checkbox" name="show_title" checked disabled title="Title is always shown"> Title (always shown)</label>
                    <label><input type="checkbox" name="show_description" checked> Description</label>
                    <label><input type="checkbox" name="show_tags" checked> Tags</label>
                    <label><input type="checkbox" name="show_platforms" checked> Platforms</label>
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn btn-primary">Apply</button>
                    <button type="button" class="btn" data-close>Close</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Orphaned Games Handler Modal -->
    <div id="modal-orphan-handler" class="modal" aria-hidden="true">
        <div class="modal-content">
            <header class="modal-header">
                <h2>Handle Orphaned Games</h2>
                <button class="modal-close" data-close>&times;</button>
            </header>
            <form id="form-orphan-handler" class="modal-form">
                <p id="orphan-info-text">Deleting this platform will orphan games. What would you like to do?</p>
                <div class="inline-radios vertical">
                    <label>
                        <input type="radio" name="orphan_action" value="delete" checked>
                        Delete the platform and orphan the games.
                    </label>
                    <label>
                        <input type="radio" name="orphan_action" value="remap">
                        Move the games to an existing platform:
                        <select name="remap_platform_id" id="orphan-remap-select" disabled>
                            <!-- JS will populate -->
                        </select>
                    </label>
                    <label>
                        <input type="radio" name="orphan_action" value="new">
                        Move the games to a new temporary platform named:
                        <input type="text" name="new_platform_name" id="orphan-new-name" disabled>
                    </label>
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn btn-primary">Proceed</button>
                    <button type="button" class="btn" data-close>Cancel</button>
                </div>
            </form>
        </div>
    </div>


    <script type="module" src="/js/main.js"></script>
</body>
</html>
